@*@page "/profile"
*@@using CaloriesCatcher.UI.Components;
@using CaloriesCatcher.UI.Model;
@using CaloriesCatcher.UI.Service.IService;
@using Newtonsoft.Json;
@using System.Security.Claims
<AuthorizeView>
    <Authorized>
        <MudGrid>
            <MudItem xs="12">
                <MudPaper Class="d-flex align-center justify-center mud-width-full py-8">
                    <MudText Typo="Typo.h3">User Settings</MudText>
                </MudPaper>
            </MudItem>

            <MudItem xs="3">
                <MudList Class=" align-center justify-center">
                    <MudListItem><MudTextField @bind-Value="userDetail.Height" Label="Height" Variant="Variant.Text" /></MudListItem>
                    <MudListItem><MudTextField @bind-Value="userDetail.Weight" Label="Weight" Variant="Variant.Text" /></MudListItem>
                    <MudListItem><MudTextField @bind-Value="userDetail.DailyCalories" Label="DailyGoal" Variant="Variant.Text" /></MudListItem>
                    <MudListItem><MudTextField @bind-Value="userDetail.BirthDate" Label="Age" Variant="Variant.Text" /></MudListItem>
                    <MudListItem><MudTextField @bind-Value="userDetail.Gender" Label="Gender" Variant="Variant.Text" /></MudListItem>
                </MudList>
            </MudItem>
            <MudItem xs="3">
                <MudList Class=" align-center justify-center">
                    <MudListItem><MudIcon Icon="@Icons.Material.Filled.Edit" Title="Edit" /></MudListItem>
                    <MudListItem><MudIcon Icon="@Icons.Material.Filled.Edit" Title="Edit" /></MudListItem>
                    <MudListItem><MudIcon Icon="@Icons.Material.Filled.Edit" Title="Edit" /></MudListItem>
                    <MudListItem><MudIcon Icon="@Icons.Material.Filled.Edit" Title="Edit" /></MudListItem>
                    <MudListItem><MudIcon Icon="@Icons.Material.Filled.Edit" Title="Edit" /></MudListItem>
                </MudList>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudPaper Class="d-flex align-left  mud-width-full py-8">User Name:</MudPaper>
                <MudPaper Class="d-flex align-left  mud-width-full py-8">Password:</MudPaper>
            </MudItem>
        </MudGrid>
    </Authorized>
    <NotAuthorized>
        <NotAuthorzied />
    </NotAuthorized>
</AuthorizeView>

@code {
    [Inject] IUserDetailService userDetailService { get; set; } = default!;

    [CascadingParameter]
    Task<AuthenticationState> authenticationState { get; set; } = default!;


    public UserDetail userDetail { get; set; } = default!;


    protected override async Task OnInitializedAsync()
    {

        await GetUserDetailData();

    }

    async Task GetUserDetailData()
    {
        var authState = await authenticationState;

        var response = await userDetailService.GetByUser(authState.User.FindFirst("Sub")?.Value);
        if (response.IsSuccess)
        {
            var t = response;
            // var test = JsonConvert.DeserializeObject<UserDetail>(Convert.ToString(response.Result));
            StateHasChanged();
        }
    }

}

